<h1 class="p-4">Exercise Sheets</h1>


<div class="d-flex row px-4">
    <p *ngIf="showAlert">
        <ngb-alert type="danger" (closed)="closeAlert()">{{alertMessage}}</ngb-alert>
    </p>
    <div *ngIf="!isProfessor && isLoaded" class="justify-content-start col">
        <ng-select [clearSearchOnAdd]="true" [searchable]="true" (change)="filterAuthorsChange($event)"
                   [clearable]="false" [items]="authors"
                   [multiple]="true" bindLabel="name" placeholder="Filter by author">
        </ng-select>
    </div>
    <div *ngIf="isLoaded" class="col">
        <ng-select [clearSearchOnAdd]="true" [searchable]="true" (change)="filterCoursesChange($event)"
                   [clearable]="false"
                   [items]="courses" [multiple]="true" bindLabel="name" placeholder="Filter by course">
        </ng-select>
    </div>
    <div *ngIf="isLoaded" class="col">
        <ng-select [clearSearchOnAdd]="true" [searchable]="true" (change)="filterCategoriesChange($event)"
                   [clearable]="false"
                   [items]="categories" [multiple]="true" bindLabel="name" placeholder="Filter by category">
        </ng-select>
    </div>
    <div class="text-end col" style="margin-top: 15px" *ngIf="isProfessor && isLoaded">
        <a class=" btn btn-primary" routerLink="/create-exercise-sheet">
            <i class="bi bi-plus-circle"></i>
            Create Exercise Sheet</a>
    </div>
</div>


<div *ngIf="showLoading" class="d-flex justify-content-center px-4">
    <div class="spinner-border text-primary" role="status">
        <span class="sr-only"></span>
    </div>
</div>


<div *ngIf="filteredSheets?.length" class="px-4">
    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col" class="col-lg"> Title</th>
                <th scope="col" class="col-lg"> Course</th>
                <th scope="col" class="col-lg"> Category</th>
                <th *ngIf="!isProfessor" scope="col" class="col-sm"> Author</th>
                <th scope="col" class="col-sm"> Published At</th>
                <th *ngIf="isProfessor" scope="col" class="col-sm justify-content-start">Is published</th>
                <th scope="col" class="col"></th>
            </tr>
        </thead>


        <tbody *ngIf = "isLoaded">
            <tr
                *ngFor="let sheet of filteredSheets | slice: (page-1) * pageSize : (page-1) * pageSize + pageSize">

                <td scope="row">{{ sheet.title }}</td>
                <td scope="row">{{ getSheetCourses(sheet.courses) }}</td>
                <td scope="row">{{ getSheetCategories(sheet.categories) }}</td>
                <td *ngIf="!isProfessor" scope="row">{{ sheet.author.name }}</td>
                <td scope="row">{{ sheet.publishedAt | date:'dd.MM.YYYY' }}</td>
                <td *ngIf="isProfessor" scope="col">
                    <div><input class="form-check-input" type="checkbox" [(ngModel)]="sheet.isPublished"
                                (change)="toggleCheckbox(sheet.id, sheet.isPublished)"/></div>
                </td>
                <td scope="row">
                    <button type="submit" class="btn btn-success btn-sm"
                            onclick="window.open('http://www.africau.edu/images/default/sample.pdf')">
                        <i class="bi bi-download"></i>
                    </button>
                </td>

            </tr>
        </tbody>
    </table>


    <div *ngIf = "isLoaded" class="row ">
        <div class="col-1 "></div>
        <div class="col-3 ">
            <select class="form-select" style="width:200px" [ngModel]="pageSize" (ngModelChange)="setPageSize($event)">
                <option [ngValue]="5">5 items per page</option>
                <option [ngValue]="10">10 items per page</option>
                <option [ngValue]="25">25 items per page</option>
                <option [ngValue]="50">50 items per page</option>
            </select>
        </div>
        <div class="col-4  d-flex justify-content-around">
            <ngb-pagination [collectionSize]="sheets.length" [(page)]="page" [pageSize]="pageSize"
                            [boundaryLinks]="true"></ngb-pagination>
        </div>
    </div>
</div>


<div *ngIf="!filteredSheets?.length && isLoaded" class="px-4 center" style="margin-top: 15px; font-size: 20px">
    No Sheets found.
</div>
